<!-- app/templates/my_news.html -->

{% extends "base.html" %}

{% block title %}Moje Vijesti - AI Novine{% endblock %}

{% block content %}
<style>
    .user-welcome {
        background: linear-gradient(135deg, var(--primary-blue), var(--primary-blue-dark));
        color: white;
        padding: var(--space-xl);
        border-radius: 16px;
        margin-bottom: var(--space-xl);
        box-shadow: 0 4px 16px rgba(107, 133, 163, 0.2);
    }

    .user-welcome h2 {
        font-family: var(--font-secondary);
        font-size: 2rem;
        margin: 0 0 var(--space-sm) 0;
    }

    .user-categories {
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-sm);
        margin-top: var(--space-md);
    }

    .category-badge {
        background: rgba(255, 255, 255, 0.2);
        padding: var(--space-xs) var(--space-md);
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 500;
        border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .stats-bar {
        background: rgba(255, 255, 255, 0.95);
        padding: var(--space-md);
        border-radius: 12px;
        margin-bottom: var(--space-xl);
        display: flex;
        justify-content: space-around;
        flex-wrap: wrap;
        gap: var(--space-md);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .stat-item {
        text-align: center;
    }

    .stat-number {
        font-size: 1.8rem;
        font-weight: bold;
        color: var(--primary-blue);
        font-family: var(--font-secondary);
    }

    .stat-label {
        font-size: 0.85rem;
        color: var(--text-secondary);
        margin-top: 0.25rem;
    }
</style>

<!-- User Welcome Section -->
<div class="user-welcome">
    <h2>👋 Pozdrav, {{ user.full_name or user.email.split('@')[0] }}!</h2>
    <p style="margin: 0; opacity: 0.9;">Tvoje personalizirane vijesti iz {{ selected_categories|length }} kategorija</p>
    
    <div class="user-categories">
        {% for category in selected_categories %}
        <span class="category-badge">
            {% if category == 'Hrvatska' %}🇭🇷{% elif category == 'Svijet' %}🌍{% elif category == 'Ekonomija' %}💼{% elif category == 'Tehnologija' %}💻{% elif category == 'Sport' %}⚽{% elif category == 'Regija' %}🏛️{% elif category == 'Europska_unija' %}🇪🇺{% endif %}
            {{ category.replace('_', ' ') }}
        </span>
        {% endfor %}
    </div>
</div>

<!-- Statistics Bar -->
<div class="stats-bar">
    <div class="stat-item">
        <div class="stat-number">{{ total_articles }}</div>
        <div class="stat-label">Ukupno članaka</div>
    </div>
    <div class="stat-item">
        <div class="stat-number">{{ selected_categories|length }}</div>
        <div class="stat-label">Aktivne kategorije</div>
    </div>
    <div class="stat-item">
        <div class="stat-number">🤖</div>
        <div class="stat-label">AI poboljšano</div>
    </div>
</div>

<!-- Articles -->
{% if articles %}
    {% for article in articles %}
    <div class="article-item {{ article.user_category.lower().replace('_', '-') }}">
        <div class="article-header">
            {{ article.naslov }}
        </div>
        
        <div class="article-preview">
            {{ article.tekst }}
        </div>
        
        <div class="article-footer">
            <div class="article-buttons">
                <div class="main-buttons">
                    {% if article.ai_enhanced_content %}
                        <button class="action-button ai-expand-btn" onclick="toggleAIContent(this)">
                            🤖 Čitaj AI sažetak
                        </button>
                    {% endif %}
                    
                    {% if article.original_link and article.original_link != '#' %}
                        <a href="{{ article.original_link }}" target="_blank" class="action-button external-link-btn">
                            🔗 Izvorni članak
                        </a>
                    {% endif %}
                </div>
                
                <div class="share-buttons">
                    <a href="#" class="share-button share-whatsapp" onclick="shareToWhatsApp(this)" title="Podijeli na WhatsApp">
                        📱 WhatsApp
                    </a>
                    <a href="#" class="share-button share-twitter" onclick="shareToTwitter(this)" title="Podijeli na X (Twitter)">
                        🐦 Twitter
                    </a>
                    <a href="#" class="share-button share-linkedin" onclick="shareToLinkedIn(this)" title="Podijeli na LinkedIn">
                        💼 LinkedIn
                    </a>
                    <a href="#" class="share-button share-facebook" onclick="shareToFacebook(this)" title="Podijeli na Facebook">
                        👥 Facebook
                    </a>
                </div>
            </div>
            
            {% if article.ai_enhanced_content %}
            <div class="ai-enhanced-content">
                {{ article.ai_enhanced_content }}
            </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}

    <div class="articles-count">
        📊 Prikazano {{ articles|length }} personaliziranih članaka
    </div>
{% else %}
    <div class="no-articles">
        <div class="no-articles-icon">📰</div>
        <h3>Nema dostupnih vijesti</h3>
        <p>Trenutno nema vijesti za tvoje odabrane kategorije. Pokušaj ponovno kasnije.</p>
    </div>
{% endif %}

<script>
// AI content toggle
function toggleAIContent(button) {
    const article = button.closest('.article-item');
    const aiContentDiv = article.querySelector('.ai-enhanced-content');
    const isHidden = aiContentDiv.style.display === 'none' || aiContentDiv.style.display === '';
    
    if (isHidden) {
        aiContentDiv.style.display = 'block';
        aiContentDiv.style.opacity = '0';
        aiContentDiv.style.transform = 'translateY(10px)';
        
        setTimeout(() => {
            aiContentDiv.style.transition = 'all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1)';
            aiContentDiv.style.opacity = '1';
            aiContentDiv.style.transform = 'translateY(0)';
        }, 10);
        
        button.innerHTML = '🤖 Sakrij sažetak';
        button.style.background = 'linear-gradient(135deg, var(--primary-blue), var(--primary-blue-dark))';
        
        setTimeout(() => {
            aiContentDiv.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'nearest' 
            });
        }, 150);
    } else {
        aiContentDiv.style.opacity = '0';
        aiContentDiv.style.transform = 'translateY(-10px)';
        
        setTimeout(() => {
            aiContentDiv.style.display = 'none';
        }, 300);
        
        button.innerHTML = '🤖 Čitaj AI sažetak';
        button.style.background = 'linear-gradient(135deg, var(--primary-blue-light), var(--primary-blue))';
    }
}

// Social sharing functions
function getArticleData(shareButton) {
    const article = shareButton.closest('.article-item');
    const title = article.querySelector('.article-header').textContent.trim();
    const preview = article.querySelector('.article-preview').textContent.trim();
    const currentUrl = window.location.href;
    
    return {
        title: title,
        text: preview.length > 100 ? preview.substring(0, 100) + '...' : preview,
        url: currentUrl
    };
}

function shareToWhatsApp(button) {
    const data = getArticleData(button);
    const message = `*${data.title}*\n\n${data.text}\n\nPročitaj više: ${data.url}`;
    window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
    return false;
}

function shareToTwitter(button) {
    const data = getArticleData(button);
    const tweet = `${data.title}\n\n${data.url}`;
    window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(tweet)}`, '_blank');
    return false;
}

function shareToLinkedIn(button) {
    const data = getArticleData(button);
    window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(data.url)}`, '_blank');
    return false;
}

function shareToFacebook(button) {
    const data = getArticleData(button);
    window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(data.url)}`, '_blank');
    return false;
}
</script>
{% endblock %}